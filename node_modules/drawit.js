var d3 = require('d3');
var jsdom = require('node-jsdom');

//jsdom.env: jsdom.env(string, [scripts], [config], callback);

var html = '<html><head></head><body><div id="outer"></div><script src="js/d3.v3.min.js"></script></body></html>';




exports.divs = function(data){
	var P = new Promise(function(resolve, reject){
		var domdone = function(err, win){
			if(err){
				reject(0);
			}
			else{
				var doc = win.document;
				var body = doc.querySelector('body');
				var wrap = doc.querySelector('#outer');

				var sel = d3.select(wrap).selectAll('div').data(data).enter().append("div").style({height:"10px",width:"10px",background:"red"});
				
				resolve(wrap.innerHTML);
			}
		}
		jsdom.env({html: html, features:{QuerySelector:true}, done:domdone});
	});
	return P;
}



